<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/icon.svg" />
    <title>Phoodie</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      #osm-map {
        /*height: 300px;*/
        height: 96vh;
      }

      dialog {
        animation: fade-out 0.7s ease-out;
      }

      dialog:open {
        animation: fade-in 0.7s ease-out;
      }

      dialog:open::backdrop {
        background-color: black;
        animation: backdrop-fade-in 0.7s ease-out forwards;
      }

      /* Animation keyframes */

      @keyframes fade-in {
        0% {
          opacity: 0;
          transform: scaleY(0);
          display: none;
        }

        100% {
          opacity: 1;
          transform: scaleY(1);
          display: block;
        }
      }

      @keyframes fade-out {
        0% {
          opacity: 1;
          transform: scaleY(1);
          display: block;
        }

        100% {
          opacity: 0;
          transform: scaleY(0);
          display: none;
        }
      }

      @keyframes backdrop-fade-in {
        0% {
          opacity: 0;
        }

        100% {
          opacity: 0.25;
        }
      }

      body,
      button {
        font-family: system-ui;
      }
      .close {
        background: red;
        color: white;
        border: none;
        padding: 6px;
      }
      .close:hover {
        cursor: pointer;
        background: white;
        color: red;
        border: 1px solid red;
      }
      .review {
        background: green;
        color: white;
        border: none;
        padding: 6px;
      }
      .review:hover {
        cursor: pointer;
        background: white;
        color: green;
        border: 1px solid green;
      }
      .close-dialog {
        position: absolute;
        right: 10%;
        color: red;
        font-size: large;
        font-weight: 800;
      }
      .close-dialog:hover {
        cursor: pointer;
      }
      nav img {
        width: 120px;
        height: 64px;
        position: absolute;
        top: 0;
        left: 25%;
        z-index: 999;
        font-family: cursive, Verdana, Geneva, Tahoma, sans-serif;
        text-shadow: 1px 1px 3px rgb(4, 243, 44);
      }
      .review-div {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 6px;
      }
      .review-div input {
        padding: 6px;
        margin: 6px;
      }
    </style>
  </head>
  <body onload="getCurrentCoords()">
    <nav>
      <!-- <h1>Phoodie</h1> -->
      <img src="logo-black.png" alt="Phoodie" />
    </nav>
    <div id="osm-map"></div>
    <dialog id="dialog">
      <span class="close-dialog">X</span>
      Content here
      <pre id="geolocation"></pre>
      <div class="review-div">
        <h3>Leave a review</h3>
        <form>
          <input type="text" placeholder="Name of Eatery.." name="name" />
          <textarea placeholder="Review.." rows="5"></textarea>
        </form>
        <p>Comments show here</p>
      </div>
      <button class="close">close</button>
      <button class="review">review</button>
    </dialog>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      const dialogElem = document.getElementById("dialog");
      const closeBtn = document.querySelector(".close");
      const closeX = document.querySelector(".close-dialog");

      closeBtn.addEventListener("click", () => {
        dialogElem.close();
      });
      closeX.addEventListener("click", () => {
        dialogElem.close();
      });
      const geo = document.getElementById("geolocation");
      // Element where we will render the map
      var mapElement = document.getElementById("osm-map");

      // Create a map in the specified element
      var map = L.map(mapElement);

      // Load and display tile layers from OpenStreetMap
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
      }).addTo(map);
      var targetCoordinates = L.latLng("0", "0");

      function getCurrentCoords() {
        if (navigator.geolocation) {
          const options = {
            enableHighAccuracy: true,
            timeout: 5000,
            maximumAge: 0,
          };
          navigator.geolocation.getCurrentPosition(
            (position) => {
              geo.innerText = `${position.coords.latitude} - ${position.coords.longitude} (Accuracy:${position.coords.accuracy}m)`;
              targetCoordinates = L.latLng(
                position.coords.latitude,
                position.coords.longitude,
              );
              map.setView(targetCoordinates, 16);
              // Add a marker at the defined coordinates
              L.marker(targetCoordinates)
                .addTo(map)
                .on("click", () => dialogElem.showModal());
            },
            (error) => {
              geo.innerText = `Error: ${error.message}`;
            },
          );
        } else {
          geo.innerText = "Geolocation isn't supported by this browser..";
        }
      }

      // // Define the desired geographic coordinates
      // var targetCoordinates = L.latLng("47.50737", "19.04611");
      // geo.innerText = targetCoordinates;

      // Set the initial view of the map
      //map.setView(targetCoordinates, 16);

      // // Add a marker at the defined coordinates
      // L.marker(targetCoordinates)
      //   .addTo(map)
      //   .on("click", () => dialogElem.showModal());
    </script>
  </body>
</html>
